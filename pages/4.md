[Top](../README.md)
# ４．システム構成要素
## システム処理形態
- 集中処理
  - 管理が楽
  - オンライントランザクション処理になる
  - シンクライアント
    - クライアントは最低限の機能のみ
    - ⇔ファットクライアント
    - VDI（デスクトップ仮想化）：PCとVDIサーバは画面転送プロトコルだけを利用する
- 分散処理
  - 機能、リスク分散
  - 水平機能分散：役割分担
  - 垂直機能分散：階層的に役割を与える（クライアントサーバシステムなど）
  - 水平負荷分散：同じ機能を複数で行う

## クライアントサーバシステム
- 3層クライアントサーバシステム
  - プレゼンテーション層：UI
  - アプリケーション層：業務ロジック
  - データベース層：データベース操作
  - 例）RailsのMVCモデル
- ストアドプロシージャ 
  - SQL命令群（プロシージャ）を実行可能な状態でデータベースに置いておく
  - クライアントはプロシージャを呼び出すだけでSQL操作が可能
- RPC
  - 他のコンピュータ上のプロシージャを呼び出して、自分のコンピュータにあるものと同じように実行する
  - CORBAに応用
- NFS
  - 他のコンピュータ上のファイルを自分のコンピュータにあるかのように操作する
  - ファイルサーバ
  - WindowsでいうところのCIFS

## 信頼性設計
- デュアルシステム
  - 多重化し、結果を照合する
  - 不一致→再処理
  - 障害発生→切り離し
  - 復旧が早い
- デュプレックスシステム
  - アクティブとスタンバイ
  - 障害発生→スタンバイへ切り替え
    - アクティブ→スタンバイ：バックアップ
    - スタンバイ→アクティブ：動作監視
  - スタンバイの状態
    - ホット：起動しておく
    - ウォーム：OSだけ起動しておく
    - コールド：起動していないor全く別の処理をしておく
- 高信頼性の考え方
  - フォールトアボイダンス：故障しないように高品質化
  - フォールトトレランス：故障前提で、冗長化
    - フェールソフト：機能低下を許容し、最低限の機能を維持
    - フェールセーフ：安全性を重視して、機能を維持
    - フェールオーバ：自動的にスタンバイに引き継ぐ
    - フォールトマスキング：障害発生の影響を外部に出さない
    - フールプルーフ：誤った動作に対してシステム以上が起きないように

## 高信頼性、高性能システム
- クラスタリング
  - 複数のシステムを連携させて高い能力を実現する技術
- HAクラスタ
  - 高可用性を目的として構成
  - フェールオーバクラスタ構成：アクティブ／スタンバイ
  - 負荷分散クラスタ構成：アクティブ／アクティブ
- ストレージの共有
  - メリット
    - サーバリソースの有効利用
    - サーバ障害への耐性
  - デメリット
    - ストレージアクセス競合がボトルネックになる
- グリッドコンピューティング
  - HPCの実現
  - 中央のサーバで処理を並列可能な単位に分割
  - 複数のコンピュータに処理を割当て、並列実行
  
## ストレージ
- RAID：複数の磁気ディスクを並列に並べ、論理的な1つのディスクとして扱う
  - RAID0：ストライピング（分散配置）により、入出力速度を向上
  - RAID1：ミラーリング（データの冗長化）により、信頼性向上
  - RAID2：エラー訂正用のディスクを追加
  - RAID3：バイト（ビット）単位でストライピング、誤り訂正符号を保存するディスクを別に用意
  - RAID4：ブロック単位でストライピング、パリティディスクへのアクセス集中が課題
  - RAID5：ブロック単位でストライピング、パリティディスクもプロック単位で分散
  - RAID6：パリティディスクを2つに追加
  - RAID01：ストライピング2台をミラーリング
  - RAID10：ミラーリング2台をストライピング
- ストレージの接続
  - DAS：サーバに直接接続
  - NAS：LANに接続、NFS,CIFSに対応
  - SAN：サーバとは別のストレージ専用ネットワーク
    - アクセスはブロック単位
    - FC（ファイバチャネル）スイッチ／ケーブルによりギガビット級のデータ転送
      - SCSIプロトコルが使われる
    - IP-SAN：TCP/IPだから安いけど、遅い
    - FCoE：FCとイーサネットを統合する技術
  - Hadoop：ペタバイト級の大規模データを複数のサーバで分散処理するミドルウェア
    - HDFS：分散ファイルシステム
    - MapReduce：分散処理フレームワーク

## 仮想化技術
- ストレージ仮想化
  - シンプロビジョニング：実使用容量より大きめの仮想ボリュームを提供する
  - ストレージ自動仮想化：データ特性に応じて格納ストレージを適切に割り当てる
- サーバ仮想化
  - ホスト型：ホストOSの上で、仮想化ソフトウェアを動かし、その中で仮想サーバを稼働させる
  - ハイパバイザ型：仮想環境を制御するプログラムをハードウェア上で直接動かす。ハードウェアの細かい制御が可能
  - コンテナ型：ホストOS上に論理的な区画（コンテナ）を作る。OSが共通。コンテナはプロセスに近い
  - ライブマイグレーション
    - 仮想サーバ上のOSやアプリケーションを稼働させたまま、別の物理サーバへ移植
  - クラスタソフトウェア
    - 仮想サーバを冗長化させる場合、管理／制御を担うソフトウェア

## 待ち行列理論
- 平均到着率 $\lambda$
  - 単位時間あたりに到着するトランザクション数
- 平均サービス率 $\mu$
  - 単位時間あたりにサービス可能なトランザクション数
  - 逆数が平均サービス時間
- 利用率 $\rho$
  - 単位時間あたりに窓口を利用している割合
  - $\rho=\lambda/\mu$ ＝平均到着率×平均サービス時間
- M/M/1モデル
  - 要求の到着タイミングはランダム（M）
  - 処理時間はランダム（M）
  - 処理の窓口は１つ（1）
  - 平均待ち時間
    - トランザクションが待ち行列内にいる時間（サービスを受けている時間を除く）
    - $\rho/1-\rho$ ×平均サービス時間
  - 平均応答時間
    - トランザクションが待ち行列内にいる時間（サービスを受けている時間を含む）
    - $1/1-\rho$ ×平均サービス時間 ＝平均待ち時間＋平均サービス時間
- M/M/Sモデル
  - 要求の到着タイミングはランダム（M）
  - 処理時間はランダム（M）
  - 処理の窓口はSコ（S）
  - 利用率 $\rho=\lambda/\mu\div S$
  - 平均待ち時間
    - $P$ ：すべての窓口がサービス中である確率
    - $P/(1-\rho)\cdot S$ ×平均サービス時間

## 信頼性特性と評価
- RASIS
  - Reliability（信頼性）：平均故障間隔
  - Availability（可用性）：稼働率＝平均故障間隔／(平均故障間隔＋平均修理間隔)
  - Serviceability（保守性）：平均修理時間
  - Integrity（保全性）：データの完全性
  - Security（安全性）：データの機密性
- バスタブ曲線
  - 初期故障期間、偶発故障期間、摩耗故障期間
  - ワイブル分布：時間とともに発生する故障減少を統計的にモデル化